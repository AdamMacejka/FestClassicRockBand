<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Fest Classic Rock Band</title>
  <link rel="stylesheet" href="styles.css"/>
  <!-- js-yaml na parsovanie YAML z CMS -->
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> <!-- na markdown -->
</head>
<body>
  <header class="hero" id="hero">
    <div class="overlay">
      <h1 id="band-name">Fest Classic Rock Band</h1>
      <p id="tagline">Rockové hity, ktoré nezabúdajú</p>
      <nav>
        <a href="#about">O nás</a>
        <a href="#members">Členovia</a>
        <a href="#concerts">Koncerty</a>
        <a href="#contact">Kontakt</a>
      </nav>
    </div>
  </header>

  <section id="about" class="section">
    <h2>O nás</h2>
    <div id="about-text">
      <p>Text doplníme neskôr...</p>
    </div>
  </section>

  <section id="members" class="section">
    <h2>Členovia</h2>
    <div class="members-grid">
      <!-- môžeš buď staticky, alebo doplniť dynamicky podobne ako nižšie -->
      <div class="member">
        <div class="photo-placeholder"></div>
        <h3>Miro</h3>
        <p>Basgitara</p>
      </div>
      <!-- ďalší -->
    </div>
  </section>

  <section id="concerts" class="section">
    <h2>Koncerty</h2>
    <p>Informácie o koncertoch doplníme čoskoro.</p>
  </section>

  <section id="contact" class="section">
    <h2>Kontakt</h2>
    <p>Email: <a id="contact-email" href="mailto:booking@festclassicrockband.com">booking@festclassicrockband.com</a></p>
  </section>

  <footer class="footer">
    <p>© 2025 Fest Classic Rock Band</p>
  </footer>

  <script>
    async function loadHomepage() {
      try {
        const res = await fetch('/content/homepage.yml');
        if (!res.ok) throw new Error('Nepodarilo sa stiahnuť homepage.yml');
        const text = await res.text();
        const data = jsyaml.load(text);

        // Titulka
        document.getElementById('band-name').textContent = data.band_name || '';
        document.getElementById('tagline').textContent = data.tagline || '';

        // Cover image ako pozadie headeru
        if (data.cover_image) {
          const hero = document.getElementById('hero');
          hero.style.backgroundImage = `url('${data.cover_image}')`;
          hero.style.backgroundSize = 'cover';
          hero.style.backgroundPosition = 'center';
        }

        // O nás
        if (data.about_text) {
          document.getElementById('about-text').innerHTML = marked ? marked(data.about_text) : '<p>' + data.about_text + '</p>';
        }

        // Kontakt
        if (data.contact_email) {
          const emailEl = document.getElementById('contact-email');
          emailEl.textContent = data.contact_email;
          emailEl.href = 'mailto:' + data.contact_email;
        }
      } catch (e) {
        console.error('Chyba pri načítaní homepage obsahu:', e);
      }
    }

    // voliteľne: načítať markdown správne (ak chceš formátovanie)
    // pridaj pred týmto <script> napr.:
    // <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    loadHomepage();
  </script>
  <script>
  async function fetchMembers() {
    const repo = 'AdamMacejka/FestClassicRockBand';
    const branch = 'main';
    const apiBase = `https://api.github.com/repos/${repo}/contents/content/members?ref=${branch}`;
  
    try {
      const listRes = await fetch(apiBase);
      if (!listRes.ok) throw new Error('Nepodarilo sa získať zoznam členov');
      const files = await listRes.json(); // pole súborov v content/members
  
      const members = [];
  
      for (const file of files) {
        if (!file.name.endsWith('.md')) continue;
        // stiahni surový markdown
        const mdRes = await fetch(file.download_url);
        if (!mdRes.ok) continue;
        const text = await mdRes.text();
  
        // vyparsuj frontmatter (--- ... ---)
        const match = text.match(/^---\s*([\s\S]*?)\s*---/);
        if (!match) continue;
        const frontmatter = match[1];
        const data = jsyaml.load(frontmatter);
        members.push({
          name: data.name,
          instrument: data.instrument,
          image: data.image,
        });
      }
  
      renderMembers(members);
    } catch (e) {
      console.error('Chyba pri načítaní členov:', e);
    }
  }
  
  function renderMembers(members) {
    const grid = document.querySelector('.members-grid');
    if (!grid) return;
    grid.innerHTML = ''; // vyčisti placeholdery
  
    members.forEach(m => {
      const el = document.createElement('div');
      el.className = 'member';
      el.innerHTML = `
        <div class="photo">
          ${m.image ? `<img src="${m.image}" alt="${m.name}"/>` : `<div class="photo-placeholder"></div>`}
        </div>
        <h3>${m.name || '–'}</h3>
        <p>${m.instrument || ''}</p>
      `;
      grid.appendChild(el);
    });
  }
  
  // Spusti načítanie po loadnutí
  fetchMembers();
  </script>
    <script>
  async function loadHomepage() {
    try {
      const res = await fetch('/content/homepage.yml');
      if (!res.ok) throw new Error('Nepodarilo sa stiahnuť homepage.yml');
      const text = await res.text();
      const data = jsyaml.load(text);
  
      // Názov a tagline
      document.getElementById('band-name').textContent = data.band_name || 'Fest Classic Rock Band';
      document.getElementById('tagline').textContent = data.tagline || '';
  
      // Cover / placeholder
      const hero = document.getElementById('hero');
      let imageUrl = '';
  
      if (data.cover_image) {
        imageUrl = data.cover_image;
      } else if (data.placeholder_image) {
        imageUrl = data.placeholder_image;
      }
  
      if (imageUrl) {
        hero.style.backgroundImage = `url('${imageUrl}')`;
        hero.style.backgroundSize = 'cover';
        hero.style.backgroundPosition = 'center';
      }
  
      // O nás (markdown)
      if (data.about_text) {
        const aboutEl = document.getElementById('about-text');
        if (window.marked) {
          // nové verzie používajú marked.parse
          if (typeof marked === 'function') {
            aboutEl.innerHTML = marked(data.about_text);
          } else if (marked.parse) {
            aboutEl.innerHTML = marked.parse(data.about_text);
          } else {
            aboutEl.textContent = data.about_text;
          }
        } else {
          aboutEl.textContent = data.about_text;
        }
      }
  
      // Kontakt
      if (data.contact_email) {
        const emailEl = document.getElementById('contact-email');
        emailEl.textContent = data.contact_email;
        emailEl.href = 'mailto:' + data.contact_email;
      }
    } catch (e) {
      console.error('Chyba pri načítaní homepage obsahu:', e);
    }
  }
  
  document.addEventListener('DOMContentLoaded', loadHomepage);
  </script>
</body>
</html>
